'use strict';

var chunkVGYK7QL7_cjs = require('./chunk-VGYK7QL7.cjs');
var chunkJBQWDK4N_cjs = require('./chunk-JBQWDK4N.cjs');
var chunkMZPFXC6Z_cjs = require('./chunk-MZPFXC6Z.cjs');
var chunk5AGTHIZZ_cjs = require('./chunk-5AGTHIZZ.cjs');
var chunkIBY4TCPG_cjs = require('./chunk-IBY4TCPG.cjs');
var chunkY6BHMVEG_cjs = require('./chunk-Y6BHMVEG.cjs');
var chunkF65ZYAX4_cjs = require('./chunk-F65ZYAX4.cjs');
var chunk25IPLJXO_cjs = require('./chunk-25IPLJXO.cjs');
var chunkH7FS2VTU_cjs = require('./chunk-H7FS2VTU.cjs');
var chunkZG3AFKVX_cjs = require('./chunk-ZG3AFKVX.cjs');
var chunkBJNRLTKL_cjs = require('./chunk-BJNRLTKL.cjs');
var l = require('axios');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var l__default = /*#__PURE__*/_interopDefault(l);

var e=new Map,i=class i{constructor(s){chunkBJNRLTKL_cjs.c(this,"config");chunkBJNRLTKL_cjs.c(this,"token");chunkBJNRLTKL_cjs.c(this,"orgNameOrId");chunkBJNRLTKL_cjs.c(this,"options");chunkBJNRLTKL_cjs.c(this,"axios");chunkBJNRLTKL_cjs.c(this,"log");chunkBJNRLTKL_cjs.c(this,"commands");chunkBJNRLTKL_cjs.c(this,"customers");chunkBJNRLTKL_cjs.c(this,"hooks");chunkBJNRLTKL_cjs.c(this,"kobjects");chunkBJNRLTKL_cjs.c(this,"logs");chunkBJNRLTKL_cjs.c(this,"messages");chunkBJNRLTKL_cjs.c(this,"orgs");chunkBJNRLTKL_cjs.c(this,"settings");this.config=s,this.token=s.token,this.orgNameOrId=s.orgNameOrId,this.options=s.options,this.log=this.options.logger||new chunkMZPFXC6Z_cjs.a(`kapp:${this.options.app}`),this.options.axios?this.axios=this.options.axios:(this.axios=l__default.default.create({baseURL:this.baseUrls.api}),this.axios.interceptors.request.use(this._onRequest.bind(this))),this.commands=new chunk5AGTHIZZ_cjs.a(this),this.customers=new chunkIBY4TCPG_cjs.a(this),this.hooks=new chunkY6BHMVEG_cjs.a(this),this.kobjects=new chunkF65ZYAX4_cjs.a(this),this.logs=new chunkH7FS2VTU_cjs.a(this),this.messages=new chunkZG3AFKVX_cjs.a(this),this.orgs=new chunkVGYK7QL7_cjs.a(this),this.settings=new chunkJBQWDK4N_cjs.a(this);}get baseUrls(){return chunk25IPLJXO_cjs.a[this.options.env||"prod"]}async getToken(s){if(this.options.token)return this.options.token;if(!s&&e.has(this.orgNameOrId))return e.get(this.orgNameOrId);try{let o=await l__default.default.get(`${this.baseUrls.gateway}/v1/orgs/${this.orgNameOrId}/token`,{headers:{"x-kustomer-app-client-id":this.options.clientId,"x-kustomer-app-token":this.token,"x-kustomer-app-visibility":this.options.visibility}});return e.set(this.orgNameOrId,o.data.data.attributes.token),o.data.data.attributes.token}catch(o){this.log.error(o);}}async _onRequest(s){let o=await this.getToken();if(!o)throw new Error(`failed to get token for ${this.orgNameOrId}`);return {...s,headers:{...s.headers,Authorization:`Bearer ${o}`}}}};chunkBJNRLTKL_cjs.a(i,"API");var f=i;

exports.a = f;
