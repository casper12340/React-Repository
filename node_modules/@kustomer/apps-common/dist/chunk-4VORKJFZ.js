import { a as a$8 } from './chunk-7SXBQTXC.js';
import { a as a$9 } from './chunk-H4B7SYNX.js';
import { a as a$1 } from './chunk-USX5UFPY.js';
import { a as a$2 } from './chunk-LSX4PDVU.js';
import { a as a$3 } from './chunk-BQ4ZCX6K.js';
import { a as a$4 } from './chunk-HZQAZSOH.js';
import { a as a$5 } from './chunk-KYGNW7AV.js';
import { a as a$a } from './chunk-YHX2STX7.js';
import { a as a$6 } from './chunk-JQ44PVQ7.js';
import { a as a$7 } from './chunk-HF7AJHBA.js';
import { a, c } from './chunk-FTJSAPQ3.js';
import l from 'axios';

var e=new Map,i=class i{constructor(s){c(this,"config");c(this,"token");c(this,"orgNameOrId");c(this,"options");c(this,"axios");c(this,"log");c(this,"commands");c(this,"customers");c(this,"hooks");c(this,"kobjects");c(this,"logs");c(this,"messages");c(this,"orgs");c(this,"settings");this.config=s,this.token=s.token,this.orgNameOrId=s.orgNameOrId,this.options=s.options,this.log=this.options.logger||new a$1(`kapp:${this.options.app}`),this.options.axios?this.axios=this.options.axios:(this.axios=l.create({baseURL:this.baseUrls.api}),this.axios.interceptors.request.use(this._onRequest.bind(this))),this.commands=new a$2(this),this.customers=new a$3(this),this.hooks=new a$4(this),this.kobjects=new a$5(this),this.logs=new a$6(this),this.messages=new a$7(this),this.orgs=new a$8(this),this.settings=new a$9(this);}get baseUrls(){return a$a[this.options.env||"prod"]}async getToken(s){if(this.options.token)return this.options.token;if(!s&&e.has(this.orgNameOrId))return e.get(this.orgNameOrId);try{let o=await l.get(`${this.baseUrls.gateway}/v1/orgs/${this.orgNameOrId}/token`,{headers:{"x-kustomer-app-client-id":this.options.clientId,"x-kustomer-app-token":this.token,"x-kustomer-app-visibility":this.options.visibility}});return e.set(this.orgNameOrId,o.data.data.attributes.token),o.data.data.attributes.token}catch(o){this.log.error(o);}}async _onRequest(s){let o=await this.getToken();if(!o)throw new Error(`failed to get token for ${this.orgNameOrId}`);return {...s,headers:{...s.headers,Authorization:`Bearer ${o}`}}}};a(i,"API");var f=i;

export { f as a };
